<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Meu Perfil</title>
  <style>
   body {
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right, #f8f9fa, #e0eafc);
  margin: 0;
  padding: 40px 20px;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}

.perfil-container {
  width: 100%;
  max-width: 420px;
  background-color: #fff;
  padding: 30px 25px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  animation: fadeIn 0.4s ease-in-out;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.perfil-container h2 {
  text-align: center;
  color: #333;
  margin-bottom: 25px;
  font-size: 24px;
}

.foto-perfil {
  text-align: center;
  margin-bottom: 20px;
}

.foto-perfil img {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid #007bff;
  transition: 0.3s ease;
}

.foto-perfil img:hover {
  transform: scale(1.05);
}

input[type="file"] {
  display: block;
  margin: 10px auto 0;
  font-size: 14px;
}

form label {
  font-weight: 600;
  color: #333;
  margin-top: 12px;
  display: block;
}

form input {
  width: 100%;
  padding: 10px 12px;
  margin-top: 5px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-sizing: border-box;
  font-size: 15px;
  transition: border-color 0.3s;
}

form input:focus {
  outline: none;
  border-color: #007bff;
}

form button {
  margin-top: 20px;
  width: 100%;
  padding: 12px;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

form button:hover {
  background-color: #0056b3;
}

@media screen and (max-width: 480px) {
  .perfil-container {
    padding: 20px;
  }

  .foto-perfil img {
    width: 90px;
    height: 90px;
  }

  form input, form button {
    font-size: 15px;
  }
}

  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
</head>
<body>

  <div class="perfil-container">
    <h2>Meu Perfil</h2>
    <div class="foto-perfil">
      <img id="fotoPerfil" src="default-avatar.png" alt="Foto de Perfil" />
      <input type="file" id="uploadFoto" accept="image/*" />
    </div>

    <form id="formPerfil">
      <label for="nome">Nome:</label>
      <input type="text" id="nome" required />

      <label for="email">E-mail:</label>
      <input type="email" id="email" disabled />

      <label for="senha">Nova Senha:</label>
      <input type="password" id="senha" placeholder="Mínimo 6 caracteres" />

      <button type="submit">Salvar Alterações</button>
    </form>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBjA7mXUmX_QI7yQk_crxkvFHg2-L655GY",
      authDomain: "tccinclusao-498a0.firebaseapp.com",
      databaseURL: "https://tccinclusao-498a0-default-rtdb.firebaseio.com",
      projectId: "tccinclusao-498a0",
      storageBucket: "tccinclusao-498a0.appspot.com",
      messagingSenderId: "320924149985",
      appId: "1:320924149985:web:96149363a35cdeba4dafa0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    auth.onAuthStateChanged(async user => {
      if (!user) {
        window.location.href = 'Login_Inclusão.html';
        return;
      }

      const uid = user.uid;
      const perfilRef = db.ref('usuarios/' + uid);

      perfilRef.once('value').then(snapshot => {
        const dados = snapshot.val();
        document.getElementById('nome').value = dados.nome || '';
        document.getElementById('email').value = user.email;

        if (dados.fotoPerfilURL) {
          document.getElementById('fotoPerfil').src = dados.fotoPerfilURL;
        }
      });

      document.getElementById('formPerfil').addEventListener('submit', async e => {
        e.preventDefault();
        const novoNome = document.getElementById('nome').value.trim();
        const novaSenha = document.getElementById('senha').value.trim();

        if (novoNome !== '') {
          await perfilRef.update({ nome: novoNome });
        }

        if (novaSenha.length >= 6) {
          await user.updatePassword(novaSenha)
            .then(() => alert('Senha atualizada com sucesso!'))
            .catch(err => alert('Erro ao atualizar senha: ' + err.message));
        }

        alert('Perfil atualizado com sucesso!');
      });

      document.getElementById('uploadFoto').addEventListener('change', e => {
        const arquivo = e.target.files[0];
        if (!arquivo) return;

        const storageRef = storage.ref('fotos_perfil/' + uid);
        storageRef.put(arquivo).then(() => {
          storageRef.getDownloadURL().then(url => {
            perfilRef.update({ fotoPerfilURL: url });
            document.getElementById('fotoPerfil').src = url;
            alert("Foto de perfil atualizada!");
          });
        }).catch(err => {
          alert("Erro ao enviar foto: " + err.message);
        });
      });
    });
  </script>
</body>
</html>
